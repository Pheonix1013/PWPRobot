<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Robot Login + GUI</title>
  <style>
    body { margin: 0; font-family: Arial; }
    #login-screen {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; height: 100vh;
    }
    #app-screen { display: none; height: 100vh; }
    table { width: 100%; height: 100%; border-collapse: collapse; }
    td { border: 1px solid black; }
  </style>
</head>

<body>

  <table border="1" width="100%" height="100%">
    <tr height="50%">
      <td width="50%" align="center" valign="middle">
        <h3><img src="http://192.168.240.9:5000/video_feed" width="480" height="320"></h3>
      </td>

      <td width="50%" align="center" valign="middle">
        <table>
          <tr align="center">
            <td></td>
            <td><button onclick="sendCommand('forward')">&#8593;</button></td> <!-- ↑ -->
            <td></td>
          </tr>
          <tr align="center">
            <td><button onclick="sendCommand('left')">&#8592;</button></td> <!-- ← -->
            <td><button onclick="stopMotor()">&#9632;</button></td> <!-- ■ -->
            <td><button onclick="sendCommand('right')">&#8594;</button></td> <!-- → -->
          </tr>
          <tr align="center">
            <td></td>
            <td><button onclick="sendCommand('backward')">&#8595;</button></td> <!-- ↓ -->
            <td></td>
          </tr>
        </table>
      </td>
    </tr>

    <tr height="50%">
      <td width="50%" align="center" valign="middle">
        <h3><img src="http://192.168.240.9:5000/video_feed" width="480" height="320"></h3>
      </td>
      <td width="50%" align="center" valign="middle">
        <h3>Placeholder (bottom-right)</h3>
      </td>
    </tr>
  </table>

  <script>
    const API_BASE = "http://127.0.0.1:5000"; // change to your Pi IP if needed

    async function sendCommand(direction) {
      try {
        const response = await fetch(`${API_BASE}/${direction}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" }
        });
        const data = await response.json();
        console.log("Response:", data);
      } catch (error) {
        console.error("Error sending command:", error);
      }
    }

    async function stopMotor() {
      try {
        const response = await fetch(`${API_BASE}/stop`, {
          method: "POST",
          headers: { "Content-Type": "application/json" }
        });
        const data = await response.json();
        console.log("Response:", data);
      } catch (error) {
        console.error("Error sending command:", error);
      }
    }


/* ---------- LOGIN & REGISTER ---------- */

async function registerUser() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();

  const res = await fetch(API + "/register", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({username: u, password: p})
  });

  const data = await res.json();
  document.getElementById("login-msg").innerText = data.message || data.detail;
}

async function loginUser() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();

  const res = await fetch(API + "/login", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({username: u, password: p})
  });

  const data = await res.json();
  document.getElementById("login-msg").innerText = data.message || data.detail;

  if (res.ok) {
    document.getElementById("login-screen").style.display = "none";
    document.getElementById("app-screen").style.display = "block";
  }
}

/* ---------- ROBOT CONTROLS ---------- */

async function cmd(direction) {
  log("POST /" + direction);
  const res = await fetch(API + "/" + direction, {method: "POST"});
  log("Response: " + JSON.stringify(await res.json()));
}

async function stopMotor() {
  log("POST /stop");
  const res = await fetch(API + "/stop", {method: "POST"});
  log("Response: " + JSON.stringify(await res.json()));
}

/* ---------- LOGGING ---------- */

function log(msg) {
  const box = document.getElementById("console-log");
  box.textContent += msg + "\n";
  box.scrollTop = box.scrollHeight;
}
</script>

</body>
</html>

